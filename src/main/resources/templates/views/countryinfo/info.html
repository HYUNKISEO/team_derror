<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>

<body>

<div id="eventTitle"></div>
<div id="eventDetail"></div>

<script>
    function getParameterByName(name, url = window.location.href) {
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
        const results = regex.exec(url);

        return results ? decodeURIComponent(results[2].replace(/\+/g, ' ')) : null;

    }
    // 추출한 파라미터 값들을 변수에 저장
    const eventName = getParameterByName('eventName');
    const venueName = getParameterByName('venueName');
    const cityName = getParameterByName('cityName');

    // 예시: 이벤트 제목을 화면에 표시
    const eventTitleElement = document.getElementById('eventTitle');
    eventTitleElement.innerText = eventName;


    const eventNameParam = getParameterByName('cityName');
    const apiUrl = `http://localhost:8080/countryinfo/list`;
    console.log(apiUrl)

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            detail(data, eventNameParam)
        })
        .catch(error => {
            console.error('데이터를 가져오는 중 오류 발생:', error);
        });

    function detail(data, eventName) {
        const embedded = data._embedded;
        const events = embedded.events;
        const venues = events._embedded.venues;

        const selectedEvent = events.find(event => event.name === eventName);

        const eventDetailElement = document.getElementById('eventDetail')
        let eventDt = `
            <p>${events.name}</p>
            <p>${events.type}</p>

        `;
        eventDetailElement.innerHTML = eventDt;
    } // end detail()


    // 콘솔에 출력
    console.log(eventName, venueName, cityName);
    console.log(eventNameParam);

    // <p>${selectedEvent.dates.start.localDate} ${selectedEvent.dates.start.localTime}</p>
    // <p>${selectedEvent.dates.start.dateTime}</p>
    // <p>${selectedEvent._embedded.venues[0].country.name}</p>
    // <p>${selectedEvent._embedded.venues[0].city.name}</p>
    // <p>${selectedEvent._embedded.venues[0].address.line1}</p>
    // <p>${selectedEvent._embedded.venues[0].upcomingEvents._total}</p>

</script>

</body>
</html>